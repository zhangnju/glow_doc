<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Glow: Getting Started with ONNXIFI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Glow
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting Started with ONNXIFI </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>https://github.com/onnx/onnx/blob/master/docs/ONNXIFI.md "ONNXIFI" is an interface that allows PyTorch/Caffe2 to use Glow as an execution backend. Right now, <a href="https://github.com/houseroad/foxi">FOXI</a> (i.e., ONNXIFI with Facebook Extension) is used to support more features.</p>
<p>Setting up a Caffe2 environment to use Glow via ONNXIFI can be tricky the first time. The steps in this walkthrough show how to build all the required components from source. They have been tested using Ubuntu 16.04 and Python 3.6.</p>
<p>**(TODO: You'll need to apt-get install some packages to get everything to build, but I don't remember all of them.)**</p>
<p>While not required, we recommend using a Python virtual environment, to avoid quirks associated with the system Python environment.</p>
<div class="fragment"><div class="line">cd $SRC</div><div class="line">mkdir virtualenv &amp;&amp; cd virtualenv &amp;&amp; virtualenv . &amp;&amp; source bin/activate</div><div class="line">pip install pyyaml pytest future</div></div><!-- fragment --><p>Get PyTorch, ONNX and Glow.</p>
<div class="fragment"><div class="line">cd $SRC</div><div class="line">git clone https://github.com/pytorch/pytorch.git</div><div class="line">git clone https://github.com/onnx/onnx.git</div><div class="line">git clone https://github.com/pytorch/glow.git</div></div><!-- fragment --><p>Build and install ONNX.</p>
<div class="fragment"><div class="line">cd $SRC/onnx</div><div class="line">git submodule update --init --recursive</div><div class="line">python setup.py install</div></div><!-- fragment --><p>Build Glow and copy/rename its ONNXIFI library.</p>
<div class="fragment"><div class="line">cd $SRC/glow</div><div class="line">git submodule update --init --recursive</div><div class="line">mkdir build &amp;&amp; cd build &amp;&amp; cmake -G Ninja -DGLOW_WITH_OPENCL=OFF .. &amp;&amp; ninja all</div><div class="line">mkdir -p $HOME/lib</div><div class="line">cp lib/Onnxifi/libonnxifi-glow.so $HOME/lib/libonnxifi.so</div><div class="line">export LD_LIBRARY_PATH=$HOME/lib:$LD_LIBRARY_PATH</div></div><!-- fragment --><p>Build and install PyTorch.</p>
<div class="fragment"><div class="line">cd $SRC/pytorch</div><div class="line">git submodule update --init --recursive</div><div class="line">python setup.py install</div></div><!-- fragment --><p>Remove the dummy libonnxifi.so that PyTorch installs. **(TODO: Needing to do this is weird. Can we avoid it?)**</p>
<div class="fragment"><div class="line">find $SRC/pytorch/build -name libonnxifi.so -delete</div><div class="line">find $SRC/virtualenv -name libonnxifi.so -delete</div></div><!-- fragment --><p>Test your installation.</p>
<div class="fragment"><div class="line">cd $SRC/pytorch/build</div><div class="line">sed -i.orig &#39;s/@unittest.skip/#@unittest.skip/&#39; caffe2/python/onnx/test_onnxifi.py</div><div class="line">python -m pytest -s caffe2/python/onnx/test_onnxifi.py</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
