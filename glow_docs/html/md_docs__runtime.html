<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Glow: Glow Runtime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Glow
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Glow Runtime </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Glow runtime is responsible for handling adding and running networks on Glow. Below is a high level view of the runtime architecture. It consists of five key components: HostManager, DeviceManager, Partitioner, Provisioner, and Executor.</p>
<h1>Data Structures:</h1>
<p>There are a few key data structures used by the runtime and can be found in <a class="el" href="_runtime_types_8h_source.html">RuntimeTypes.h</a>, they are discussed below.</p>
<h3>DeviceInfo:</h3>
<p>This structure contains information about the device that the partitioner will use to partition a network. This inlcudes things like available memory and computation capability.</p>
<h3>DeviceConfig:</h3>
<p>A base class used in configuring a DeviceManager. It is meant to contain information that allows the DeviceManager to uniquely identify the device and initialize it.</p>
<h3>DAG</h3>
<p>When a network is partitioned, its partitions and their relations are modeled in a DAG. The DAG contains the information for the entire network.</p>
<h3>DAGNode</h3>
<p>The DAGNode is a single node in the DAG and contains everything needed to run a partition and model the partitions's dependencies.</p>
<h1>Components</h1>
<p>The runtime is composed of a few key elements: HostManager, Partitioner, Provisioner, Executor, and DeviceManager.</p>
<div class="image">
<object type="image/svg+xml" data="glow_runtime.svg">glow_runtime.svg</object>
</div>
<h3>Host Manager:</h3>
<p>The HostManager is the container for the other components. It serves as the interface externally, handling network init and run requests. The HostManager routes a request through the other components and stores the executionDAG for each network family member.</p>
<h3>Partitioner:</h3>
<p>This component is responsible for dividing up the provided network into sub-networks that can be run on multiple devices. It receives a Module and DeviceInfo from the HostManager and lowers the module. Then it does the partitioning based on hardware constraints and heuristics to optimize execution time. It outputs a list of executionDAGs, one per network.</p>
<h3>Provisioner:</h3>
<p>The Provisioner takes in the list of executionDAG and assigns sub-function to specific devices. The Provisioner compiles each sub-function and stores them in a map, it then passes a pointer to the compiledFunction and a Module reference to the DeviceManager to initialize the function on the device. It fills in the remaining fields of the excecutionDAGs and returns them in a list to the HostManager.</p>
<h3>Executor:</h3>
<p>The Executor handles the execution of the network. It walks the executionDAG calling execution of each sub network in accordance with their dependencies. This handles allocation of contexts for the sub-networks, and moving one network's outputs to the inputs of another network.</p>
<h3>Device Manager:</h3>
<p>The DeviceManager is an abstraction for the device which runs on the host. The manager handles initializing the device, collecting constants and preparing the device for execution, and executing a network on the device. It also handles unloading networks from the device. There is a backend specific DeviceManager per backend type.</p>
<h1>Device API:</h1>
<p>There is a pairing between the backend and the device manager. The backend is provided a module which contains the computation graph. It returns a backend specific compiled function which inherits from compiledFunction and contains the instructions to run the network on the device. The compiledFunction will serve as a container/abstraction for device specific executable code. The specific format is left to the backend implementation.</p>
<p>The backend specific device manager inherits from DeviceManager and consumes the compiledFunction generated by its matching backend. The DeviceManager knows how to copy the device specific code to the device and initialize it for execution. The DeviceManager also handles execution which means loading the inputs to the device waiting for the device to signal that the outputs are ready, and copying outputs from the device.</p>
<div class="image">
<object type="image/svg+xml" data="backend_dm_api.svg">backend_dm_api.svg</object>
</div>
<h1>Network Initialization:</h1>
<p>Below we have a diagram illustrating the process of adding a network to the Runtime.</p><ul>
<li>A Module containing some functions to be added, is provided to the HostManager.</li>
<li>The HostManager passes this Module along to the Partitioner which partitions the network.</li>
<li>The DAGs output from the Partitioner are then passed to the Provisioner which handles actual device allocation.</li>
<li>The DeviceManager handles preparing the device to run the function. This includes allocating memory on the device, copying constants from the Module to the device, and loading the function on the device.</li>
</ul>
<div class="image">
<object type="image/svg+xml" data="network_init.svg">network_init.svg</object>
</div>
<h1>Network Execution:</h1>
<p>For execution we have a similar diagram stepping through the network execution process.</p><ul>
<li>The HostManager is provided a network name and ExecutionContext.</li>
<li>The HostManager passes the ExecutionContext on to the Executor, along with the DAG for the network.</li>
<li>The Executor calls into the DeviceManager to kick off execution for all partitions which have no unment dependancies. It procedes to walk the DAG and execute each partition as its dependancies are met.</li>
</ul>
<div class="image">
<object type="image/svg+xml" data="network_run.svg">network_run.svg</object>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
