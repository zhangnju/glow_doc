<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Glow: Graph Partitioning Support in Glow</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Glow
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Graph Partitioning Support in Glow </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Overview</h3>
<p>Along with the increased size of neural networks, a large network may not be able to run on only one accelerator/device due to resource limitation (e.g. memory capacity). Therefore, it is necessary to divide up the network into several sub-networks and each of them can be executed on one accelerator. In addition, even if a networks fits a signal card, spliting the network may improve peformance via model parallesim. This problem can be abstracted as a <a href="https://en.wikipedia.org/wiki/Graph_partition">Graph Partition problem</a> : Given a neural network and n devices, we would like to split this network into minimal k sub-networks (where k &lt;= n) , and for each sub-network, it can be run on one device with the device resource restriction.</p>
<h3>Heterogeneous partition</h3>
<p>Glow now supports Heterogeneous Partition to address this problem. Given a network, and the information of a list of devices proviced by users, Glow will try to find a posssible partition or report an error.</p>
<h4>Design</h4>
<p>The figure below shows the Heterogeneous Partition flow: a network(i.e. Glow function) is first divided up into sub-networks based on backend types and then each sub-network is divided up based on given cost model. </p><div class="image">
<img src="HeterogeneousPartition.png" width="50%"/>
</div>
<p>For Backend-Based-Partition : If a node/operator is only supported by backend A, it will be assigned to A. If a node is supported by both backends A and B, Glow chooses the one with higher priority. In addition, users can define backend-support/backend-unsupport op list. This feature allows users to run one network cross different type of backends. E.g. users can choose any node running on their accelorator and the rest running on CPU.</p>
<h4>Usage</h4>
<p><a href="https://github.com/pytorch/glow/blob/master/include/glow/Runtime/RuntimeTypes.h#L50"><code>struct DeviceInfo</code></a> is required to run Partitioner. <a href="https://github.com/pytorch/glow/blob/master/tests/unittests/PartitionerTest.cpp#L614">Here</a> is an exmpale of how to call heterogeneous partition. If Glow ExecutionEngine is used to compile and run a model, users need to provide the config in a yaml file (e.g. <a href="https://github.com/pytorch/glow/blob/master/tests/runtime_test/heterogeneousConfigs.yaml">yaml file sample</a>) and EE will read it and create the DeviceConfig. This is an example: </p><div class="fragment"><div class="line">./bin/image-classifier tests/images/imagenet/*.png -image-mode=0to1 -m=resnet50 -model-input-name=gpu_0/data -cpu-memory=100000 -load-device-configs=&quot;tests/runtime_test/heterogeneousConfigs.yaml&quot;</div></div><!-- fragment --><h3>User-defined partition</h3>
<p>Glow also supports user-defined partition. This feature gives user the full control of partitioning. Given the partition configuration, which should be represented as <a href="https://github.com/pytorch/glow/blob/master/include/glow/Runtime/RuntimeTypes.h#L181"><code>struct PartitionConfig</code></a>, Glow generates the partition, and also validates the partition (memory constraint, number of partitions, and DAG). An example can be found <a href="https://github.com/pytorch/glow/blob/master/tests/unittests/PartitionerTest.cpp#L977">here</a>.</p>
<h3>Partition Debuggability</h3>
<p>The partition log can be dumpped when the llvm option <code>-log-partition=true</code> is enabled. If <code>-dump-partition=true</code> is enabled, the graph of each sub-network will be dumpped into a list of dot files. The log contains the dot file of the final DAG, the info of each part and a list of dot files for sub-networks, as the following example shows. </p><div class="fragment"><div class="line">[ RUN      ] PartitionerTest.SimpleHeterogeneousPartitioning</div><div class="line">WARNING: Logging before InitGoogleLogging() is written to STDERR</div><div class="line">I0828 15:55:28.063619 378844608 Partitioner.cpp:79] The number of partitions is : 3, and the DAG is dumped into DAG.dot file.</div><div class="line">I0828 15:55:28.064260 378844608 PartitionerBase.cpp:171] Writing dotty graph for DAG after graph partitioning: DAG.dot</div><div class="line">Writing dotty graph for Function to: partitionLogicalID1__test_part1_part1__Interpreter.dot</div><div class="line">Writing dotty graph for Function to: partitionLogicalID0__test_part2_part1__CPU.dot</div><div class="line">Writing dotty graph for Function to: partitionLogicalID1__test_part3_part1__Interpreter.dot</div><div class="line">I0828 15:55:28.065464 378844608 PartitionerUtils.cpp:494]    Partition 0:</div><div class="line">                   Name :   test_part1_part1</div><div class="line">               BackendKind :    Interpreter</div><div class="line">               total Memory :   192</div><div class="line">                     input size:    128</div><div class="line">                 output size:   64</div><div class="line">                 constant size: 0</div><div class="line">               LogicalDeviceIDs :   1</div><div class="line">I0828 15:55:28.065485 378844608 PartitionerUtils.cpp:494]    Partition 1:</div><div class="line">                   Name :   test_part2_part1</div><div class="line">               BackendKind :    CPU</div><div class="line">               total Memory :   192</div><div class="line">                     input size:    128</div><div class="line">                     output size:   64</div><div class="line">                 constant size: 0</div><div class="line">               LogicalDeviceIDs :   0</div><div class="line">I0828 15:55:28.065495 378844608 PartitionerUtils.cpp:494]     Partition 2:</div><div class="line">                   Name :   test_part3_part1</div><div class="line">               BackendKind :    Interpreter</div><div class="line">               total Memory :   256</div><div class="line">                     input size:    192</div><div class="line">                     output size:   64</div><div class="line">                     constant size: 0</div><div class="line">               LogicalDeviceIDs :   1</div><div class="line">[       OK ] PartitionerTest.SimpleHeterogeneousPartitioning (3 ms)</div></div><!-- fragment --><p>The figure below shows the genereated DAG:</p>
<div class="image">
<img src="DAG_example.png" width="60%"/>
</div>
<p>The figures below shows the graph of each each sub-network after partitioning.</p>
<div class="image">
<img src="partition1.png" width="30%"/>
</div>
 <div class="image">
<img src="partition2.png" width="30%"/>
</div>
 <div class="image">
<img src="partition3.png" width="30%"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
