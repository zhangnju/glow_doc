<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Glow: Tensors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Glow
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tensors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes the design of the Tensor data structure and explains how to use it effectively.</p>
<p>A Tensor is a multi-dimensional array. Tensors are allocated as contiguous chunks of memory. Tensors are heap allocated, and have a fixed size that's determined during construction or during tensor reset. Tensors are non-generic, and are types. This means that the tensor contains an Enum that records the type of the data (float, double, int, etc.)</p>
<p>Making tensors non-generic (they don't depend on the type of the element) makes the interfaces very clear. The neural network inference function does not need to know the types of input or output tensors. This allows us to implement networks that have non-floating point types (quantization of nodes).</p>
<h2>Handles</h2>
<p>The problem with using non-generic tensors is that calculating the location of an element becomes very expensive. In order to figure out the location of an element in memory, the Tensor subscript function needs to iterate over all dimensions and multiply the dimension of each sizes with the input indices and later multiply by the size of the element. This is extremely slow. Another problem is that the compiler can't prove that there are no pointers that point to the internal data structures of the Tensor and has to re-read the tensor dimensions and element type from memory very frequently.</p>
<p>The solution to this problem is the use of Handles. Handles are stack-allocated generic data structures that contain an optimized version of the tensor metadata. The fact that they are stack allocated allows the compiler to assume that there are no aliases to the tensor metadata. The fact that the class is generic makes the size calculation for the element type constant.</p>
<p>In practice, iterating over tensors using handles allows the compiler to perform extremely efficient index calculation, and vectorization of the pattern access!</p>
<p>Handles are only valid as long as the tensor is alive. Tensors are passed by value, and are relatively inexpensive to construct. However, it is better to initialize Handles outsize of inner loops.</p>
<p>Code example of creating tensors and the APIs to create a Handle and mutate the data:</p>
<div class="fragment"><div class="line">/// Create a tensor of type Float, of the shape {4 x 2}.</div><div class="line">Tensor inputs(ElemKind::FloatTy, {4, 2});</div><div class="line"></div><div class="line">/// Create a handle to the tensor.</div><div class="line">auto I = inputs.getHandle&lt;float&gt;();</div><div class="line"></div><div class="line">/// Store an element to the tensor at index {0, 0}.</div><div class="line">I.at({0, 0}) = 13.1;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
